import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as b}from"./iframe-CIsN2Fyl.js";import{u as E}from"./handlers-Nn_8ejmi.js";import{S as M}from"./Spinner-CVL8Mf24.js";function R({onToast:a,onNavigateDashboard:i}){const{fetchJSON:s,putJSON:o,postJSON:m}=E(),[t,n]=b.useState(null),[y,d]=b.useState(!1),[g,k]=b.useState(null),[w,h]=b.useState(!1);b.useEffect(()=>{s("/api/config/lab").then(n).catch(r=>k(r.message))},[s]);const L=async()=>{try{if((await s("/api/status")).services.some(p=>p.status==="running")){h(!0);return}}catch{h(!0);return}d(!0);const r=await j();d(!1),r&&a("Config saved","success")},j=async()=>{if(!t)return!1;try{const r=await o("/api/config/lab",t);return r.regenerateError?(a(`Saved but regeneration failed: ${r.regenerateError}`,"error"),!1):!0}catch(r){const l=r instanceof Error?r.message:"Save failed";return k(l),a(l,"error"),!1}},B=async()=>{h(!1),d(!0);const r=await j();if(d(!1),!!r){try{await m("/api/stack/restart")}catch{}i&&i()}},S=async()=>{h(!1),d(!0);const r=await j();d(!1),r&&a("Config saved (restart required to apply)","success")};if(g&&!t)return e.jsx("div",{className:"rounded-xs border border-error/30 bg-error/10 p-4 text-sm/5 text-error",children:g});if(!t)return e.jsx(M,{text:"Loading config",centered:!0});const C=t.mode==="hybrid";return e.jsx("div",{className:"mx-auto max-w-4xl",children:e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(x,{title:"Mode",icon:T,children:[e.jsx("div",{className:"flex gap-2",children:["local","hybrid"].map(r=>e.jsx("button",{onClick:()=>{const l={...t,mode:r},c=r==="local"?"local":"external";l.infrastructure={...t.infrastructure,ClickHouse:{...t.infrastructure.ClickHouse,Xatu:{...t.infrastructure.ClickHouse.Xatu,Mode:c}}},n(l)},className:`rounded-xs px-4 py-1.5 text-sm/5 font-medium transition-colors ${t.mode===r?"bg-accent text-text-primary":"bg-surface-lighter text-text-tertiary hover:text-text-primary"}`,children:r},r))}),e.jsx("p",{className:"mt-3 text-xs/4 text-text-disabled",children:C?"External Xatu ClickHouse with local CBT processing":"Fully local development environment"})]}),e.jsx(x,{title:"Observability",icon:P,children:e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:t.infrastructure.Observability.Enabled,onChange:r=>n({...t,infrastructure:{...t.infrastructure,Observability:{...t.infrastructure.Observability,Enabled:r.target.checked}}}),className:"peer sr-only"}),e.jsx("div",{className:"h-5 w-9 rounded-full bg-surface-lighter transition-colors peer-checked:bg-accent"}),e.jsx("div",{className:"absolute top-0.5 left-0.5 size-4 rounded-full bg-text-tertiary transition-all peer-checked:translate-x-4 peer-checked:bg-text-primary"})]}),e.jsx("span",{className:"text-sm/5 text-text-secondary",children:t.infrastructure.Observability.Enabled?"Prometheus & Grafana enabled":"Disabled"})]})})]}),e.jsx(x,{title:"Networks",icon:H,children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:t.networks.map((r,l)=>{const c=r.Enabled;return e.jsxs("button",{onClick:()=>{const p=[...t.networks];p[l]={...p[l],Enabled:!c},n({...t,networks:p})},className:`group flex items-center justify-between rounded-xs border px-4 py-3 text-left transition-all ${c?"border-accent/40 bg-accent/10":"border-border bg-surface hover:border-text-disabled"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm/5 font-medium ${c?"text-text-primary":"text-text-muted"}`,children:r.Name}),e.jsxs("div",{className:"text-xs/4 text-text-disabled",children:["port offset +",r.PortOffset]})]}),e.jsx("div",{className:`size-2 rounded-full ${c?"bg-accent":"bg-border"}`})]},r.Name)})})}),e.jsx(x,{title:"ClickHouse",icon:I,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Xatu",description:C?"External production data":"Local instance",cluster:t.infrastructure.ClickHouse.Xatu,onChange:r=>n({...t,infrastructure:{...t.infrastructure,ClickHouse:{...t.infrastructure.ClickHouse,Xatu:r}}})}),e.jsx(N,{label:"CBT",description:"Local processing & storage",cluster:t.infrastructure.ClickHouse.CBT,onChange:r=>n({...t,infrastructure:{...t.infrastructure,ClickHouse:{...t.infrastructure.ClickHouse,CBT:r}}})})]})}),e.jsx(x,{title:"Ports",icon:O,children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(f,{label:"Lab Backend",value:t.ports.LabBackend,onChange:r=>n({...t,ports:{...t.ports,LabBackend:r}})}),e.jsx(f,{label:"Lab Frontend",value:t.ports.LabFrontend,onChange:r=>n({...t,ports:{...t.ports,LabFrontend:r}})}),e.jsx(f,{label:"CBT Base",value:t.ports.CBTBase,onChange:r=>n({...t,ports:{...t.ports,CBTBase:r}})}),e.jsx(f,{label:"CBT API Base",value:t.ports.CBTAPIBase,onChange:r=>n({...t,ports:{...t.ports,CBTAPIBase:r}})}),e.jsx(f,{label:"CBT Frontend Base",value:t.ports.CBTFrontendBase,onChange:r=>n({...t,ports:{...t.ports,CBTFrontendBase:r}})})]})}),t.mode==="local"&&e.jsx(x,{title:"Dev Settings",icon:A,children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("label",{className:"mb-1.5 block text-xs/4 font-medium text-text-muted",children:"Xatu Ref"}),e.jsx("input",{type:"text",value:t.dev.XatuRef??"",onChange:r=>n({...t,dev:{...t.dev,XatuRef:r.target.value||void 0}}),placeholder:"master",className:"w-full rounded-xs border border-border bg-surface px-3 py-2 text-sm/5 text-text-primary placeholder:text-text-disabled focus:border-accent focus:outline-hidden"})]})}),g&&e.jsx("div",{className:"rounded-xs border border-error/30 bg-error/10 p-3 text-sm/5 text-error",children:g}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-overlay/60",children:e.jsxs("div",{className:"w-full max-w-sm rounded-sm border border-border bg-surface-light p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"size-5 text-error",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),e.jsx("h3",{className:"text-sm/5 font-semibold text-text-primary",children:"Restart Required"})]}),e.jsx("p",{className:"mb-5 text-sm/5 text-text-tertiary",children:"Lab config changes require a full stack restart. The stack will be torn down and rebooted."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"rounded-xs px-3 py-1.5 text-xs/4 text-text-muted transition-colors hover:text-text-secondary",children:"Cancel"}),e.jsx("button",{onClick:S,className:"rounded-xs bg-surface-lighter px-3 py-1.5 text-xs/4 font-medium text-text-secondary transition-colors hover:bg-text-disabled",children:"Save Only"}),e.jsx("button",{onClick:B,className:"rounded-xs bg-error px-3 py-1.5 text-xs/4 font-medium text-text-primary transition-colors hover:bg-error/80",children:"Save & Restart"})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:L,disabled:y,className:"rounded-xs bg-accent px-5 py-2 text-sm/5 font-medium text-text-primary transition-colors hover:bg-accent-light disabled:opacity-50",children:y?"Saving...":"Save & Regenerate"})})]})})}function x({title:a,icon:i,children:s}){return e.jsxs("div",{className:"rounded-sm border border-border bg-surface-light p-5",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2.5",children:[e.jsx("span",{className:"text-text-muted",children:i}),e.jsx("h3",{className:"text-sm/5 font-semibold text-text-secondary",children:a})]}),s]})}function f({label:a,value:i,onChange:s}){return e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs/4 font-medium text-text-muted",children:a}),e.jsx("input",{type:"number",value:i,onChange:o=>s(parseInt(o.target.value,10)||0),className:"w-full rounded-xs border border-border bg-surface px-3 py-2 text-sm/5 text-text-primary focus:border-accent focus:outline-hidden"})]})}function N({label:a,description:i,cluster:s,onChange:o}){const m=s.Mode==="external";return e.jsxs("div",{className:"flex flex-col gap-3 rounded-xs border border-border/50 bg-surface p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm/5 font-medium text-text-primary",children:a}),e.jsx("div",{className:"text-xs/4 text-text-disabled",children:i})]}),e.jsx("div",{className:"flex gap-1",children:["local","external"].map(t=>e.jsx("button",{onClick:()=>o({...s,Mode:t}),className:`rounded-xs px-2.5 py-1 text-xs/4 font-medium transition-colors ${s.Mode===t?"bg-accent text-text-primary":"bg-surface-lighter text-text-muted hover:text-text-secondary"}`,children:t},t))})]}),m&&e.jsxs("div",{className:"flex flex-col gap-2.5 border-t border-border/50 pt-3",children:[e.jsx(v,{label:"URL",value:s.ExternalURL??"",onChange:t=>o({...s,ExternalURL:t})}),e.jsx(v,{label:"Database",value:s.ExternalDatabase??"",onChange:t=>o({...s,ExternalDatabase:t})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2.5",children:[e.jsx(v,{label:"Username",value:s.ExternalUsername??"",onChange:t=>o({...s,ExternalUsername:t})}),e.jsx(v,{label:"Password",value:s.ExternalPassword??"",onChange:t=>o({...s,ExternalPassword:t}),type:"password"})]})]})]})}function v({label:a,value:i,onChange:s,type:o="text"}){return e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs/4 text-text-disabled",children:a}),e.jsx("input",{type:o,value:i,onChange:m=>s(m.target.value),className:"w-full rounded-xs border border-border bg-surface-light px-2.5 py-1.5 text-xs/4 text-text-primary focus:border-accent focus:outline-hidden"})]})}const u="size-4",T=e.jsxs("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),H=e.jsx("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5a17.92 17.92 0 0 1-8.716-2.247m0 0A9 9 0 0 1 3 12c0-1.47.353-2.856.978-4.082"})}),I=e.jsx("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})}),O=e.jsx("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"})}),P=e.jsx("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"})}),A=e.jsx("svg",{className:u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5"})});R.__docgenInfo={description:"",methods:[],displayName:"LabConfigEditor",props:{onToast:{required:!0,tsType:{name:"signature",type:"function",raw:"(message: string, type: 'success' | 'error') => void",signature:{arguments:[{type:{name:"string"},name:"message"},{type:{name:"union",raw:"'success' | 'error'",elements:[{name:"literal",value:"'success'"},{name:"literal",value:"'error'"}]},name:"type"}],return:{name:"void"}}},description:""},onNavigateDashboard:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{R as L};
