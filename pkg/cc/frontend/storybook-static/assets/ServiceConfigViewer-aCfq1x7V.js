import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as i}from"./iframe-CIsN2Fyl.js";import{u as L}from"./handlers-Nn_8ejmi.js";function E(r){return r.endsWith(".yml")||r.endsWith(".yaml")?"text-info":r.endsWith(".json")||r.endsWith(".toml")?"text-warning":"text-text-tertiary"}function z({onToast:r}){const{fetchJSON:o,putJSON:y,deleteAction:b}=L(),[m,f]=i.useState([]),[n,N]=i.useState(null),[s,c]=i.useState(null),[d,l]=i.useState(!1),[h,x]=i.useState(""),[v,g]=i.useState(!1),[w,j]=i.useState(!1);i.useEffect(()=>{o("/api/config/files").then(f).catch(t=>r(t.message,"error"))},[o,r]),i.useEffect(()=>{if(!n){c(null);return}j(!0),o(`/api/config/files/${n}`).then(t=>{c(t),x(t.overrideContent??t.content),l(!1)}).catch(t=>r(t.message,"error")).finally(()=>j(!1))},[n,o,r]);const k=async()=>{if(n){g(!0);try{const t=await y(`/api/config/files/${n}/override`,{content:h});t.regenerateError?r(`Override saved but regen failed: ${t.regenerateError}`,"error"):r("Override saved and configs regenerated","success");const a=await o(`/api/config/files/${n}`);c(a),l(!1);const O=await o("/api/config/files");f(O)}catch(t){r(t instanceof Error?t.message:"Save failed","error")}finally{g(!1)}}},C=async()=>{if(n&&window.confirm("Remove custom override? This will revert to the generated config."))try{await b(`/api/config/files/${n}/override`),r("Override removed","success");const t=await o(`/api/config/files/${n}`);c(t),x(t.content),l(!1);const a=await o("/api/config/files");f(a)}catch(t){r(t instanceof Error?t.message:"Delete failed","error")}},u=m.filter(t=>t.hasOverride).length,p=s?(s.hasOverride?s.overrideContent:s.content)??"":"",S=i.useMemo(()=>p.split(`
`),[p]);return e.jsxs("div",{className:"flex gap-0",style:{height:"calc(100dvh - 180px)"},children:[e.jsxs("div",{className:"flex w-60 shrink-0 flex-col overflow-hidden border-r border-border bg-surface",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"text-xs/4 font-semibold tracking-wider text-text-muted uppercase",children:"Files"}),u>0&&e.jsxs("span",{className:"rounded-full bg-warning/15 px-2 py-0.5 text-xs/3 font-medium text-warning",children:[u," override",u>1?"s":""]})]}),e.jsxs("div",{className:"flex flex-1 flex-col gap-px overflow-y-auto px-2 pb-2",children:[m.map(t=>{const a=n===t.name;return e.jsxs("button",{onClick:()=>N(t.name),className:`group flex items-center gap-2.5 rounded-xs px-3 py-2 text-left transition-colors ${a?"bg-accent/15 text-text-primary":"text-text-tertiary hover:bg-white/5 hover:text-text-secondary"}`,children:[e.jsx("svg",{className:`size-4 shrink-0 ${a?"text-accent-light":E(t.name)}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm/5",children:t.name}),t.hasOverride&&e.jsx("span",{className:"size-1.5 shrink-0 rounded-full bg-warning",title:"Has override"})]},t.name)}),m.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-xs/4 text-text-disabled",children:"No config files found"})]})]}),e.jsx("div",{className:"flex flex-1 flex-col overflow-hidden bg-surface-light/50",children:w?e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsx("div",{className:"size-5 animate-spin rounded-full border-2 border-accent-light border-t-transparent"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono text-sm/5 font-medium text-text-primary",children:s.name}),s.hasOverride&&e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-warning/15 px-2 py-0.5 text-xs/3 font-medium text-warning",children:[e.jsx("span",{className:"size-1 rounded-full bg-warning"}),"override"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!d&&e.jsxs("button",{onClick:()=>{x(s.overrideContent??s.content),l(!0)},className:"flex items-center gap-1.5 rounded-xs px-2.5 py-1 text-xs/4 font-medium text-text-tertiary transition-colors hover:bg-white/5 hover:text-text-primary",children:[e.jsx("svg",{className:"size-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),s.hasOverride?"Edit Override":"Create Override"]}),s.hasOverride&&!d&&e.jsxs("button",{onClick:C,className:"flex items-center gap-1.5 rounded-xs px-2.5 py-1 text-xs/4 font-medium text-text-muted transition-colors hover:bg-error/10 hover:text-error",children:[e.jsx("svg",{className:"size-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),"Remove"]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:k,disabled:v,className:"rounded-xs bg-accent px-3 py-1 text-xs/4 font-medium text-text-primary transition-colors hover:bg-accent-light disabled:opacity-50",children:v?"Saving...":"Save Override"}),e.jsx("button",{onClick:()=>l(!1),className:"rounded-xs px-3 py-1 text-xs/4 font-medium text-text-muted transition-colors hover:text-text-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:d?e.jsx("textarea",{value:h,onChange:t=>x(t.target.value),className:"size-full resize-none border-none bg-transparent p-4 font-mono text-xs/5 text-text-secondary focus:outline-hidden",spellCheck:!1}):e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"sticky left-0 shrink-0 border-r border-border/50 bg-surface-light/80 py-4 pr-3 pl-4 text-right font-mono text-xs/5 text-border select-none",children:S.map((t,a)=>e.jsx("div",{children:a+1},a))}),e.jsx("pre",{className:"flex-1 overflow-x-auto py-4 pr-6 pl-4 font-mono text-xs/5 text-text-secondary",children:p})]})})]}):e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"rounded-lg bg-surface-lighter/50 p-4",children:e.jsx("svg",{className:"size-10 text-border",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm/5 font-medium text-text-muted",children:"No file selected"}),e.jsx("p",{className:"mt-1 text-xs/4 text-border",children:"Choose a config file from the sidebar to view or override"})]})]})})]})}z.__docgenInfo={description:"",methods:[],displayName:"ServiceConfigViewer",props:{onToast:{required:!0,tsType:{name:"signature",type:"function",raw:"(message: string, type: 'success' | 'error') => void",signature:{arguments:[{type:{name:"string"},name:"message"},{type:{name:"union",raw:"'success' | 'error'",elements:[{name:"literal",value:"'success'"},{name:"literal",value:"'error'"}]},name:"type"}],return:{name:"void"}}},description:""}}};export{z as S};
