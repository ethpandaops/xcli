{{- define "cbt-api-config" -}}
server:
  port: {{ .Port }}
  metrics_port: {{ .MetricsPort }}
  host: 0.0.0.0
  read_header_timeout: 10s
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

clickhouse:
  dsn: "clickhouse://default:supersecret@localhost:9000?compress=true"
  database: "{{ .Network }}"
  use_final: true
  max_open_conns: 10
  max_idle_conns: 5
  conn_max_lifetime: 60s
  dial_timeout: 10s
  read_timeout: 30s
  write_timeout: 30s
  max_execution_time: 60
  insecure_skip_verify: false
  discovery:
    prefixes:
      - fct
      - int
      - dim
      - admin
    exclude:
      - "*_local"

proto:
  output_dir: "./pkg/proto/clickhouse"
  package: "cbt.v1"
  go_package: "github.com/ethpandaops/cbt-api/pkg/proto/clickhouse"
  include_comments: true

api:
  base_path: "/api/v1"
  # Only tables with these prefixes will be exposed via REST API
  expose_prefixes:
    - fct
    - dim
    - int
    - admin
  # Exclude tables matching these patterns from API exposure
  exclude:
    - "*_local"
  # Field whitelist for uint64â†’string conversion
  uint64_to_string_fields:
    - consensus_payload_value
    - execution_payload_value
    - block_number
    - total_accounts
    - total_storage_slots
    - expired_accounts
    - expired_contracts
    - total_contract_accounts
    - expired_slots
    - expired_storage_slots

telemetry:
  enabled: false

# HTTP Headers Configuration
headers:
  policies:
    - name: "openapi_spec"
      path_pattern: "^/openapi\\.yaml$"
      headers:
        Cache-Control: "public, max-age=3600, s-maxage=3600"
    - name: "api_docs"
      path_pattern: "^/docs$"
      headers:
        Cache-Control: "public, max-age=300, s-maxage=300"
    - name: "health"
      path_pattern: "^/health$"
      headers:
        Cache-Control: "public, max-age=5, s-maxage=5"
    - name: "api_queries"
      path_pattern: "^/api/v1/.*"
      headers:
        Cache-Control: "public, max-age=30, s-maxage=60, stale-while-revalidate=120"
    - name: "default"
      path_pattern: ".*"
      headers:
        Cache-Control: "no-cache, no-store, must-revalidate"
{{- end -}}
