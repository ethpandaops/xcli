# lab-dev configuration example
# This file is generated by 'lab-dev init' and can be customized for your environment

# Repository paths (auto-discovered or manually specified)
repos:
  cbt: ../cbt
  xatu_cbt: ../xatu-cbt
  cbt_api: ../cbt-api
  lab_backend: ../lab-backend
  lab: ../lab

# Operating mode: "local" or "hybrid"
# - local: All services run locally including Xatu ClickHouse cluster
# - hybrid: External Xatu data source, local transformations and APIs
mode: local

# Networks to enable
# Each network gets its own CBT engine and cbt-api instance
networks:
  - name: mainnet
    enabled: true
    port_offset: 0  # CBT: 8081, cbt-api: 8091
  - name: sepolia
    enabled: true
    port_offset: 1  # CBT: 8082, cbt-api: 8092
  # Add more networks as needed:
  # - name: holesky
  #   enabled: false
  #   port_offset: 2

# Infrastructure configuration
infrastructure:
  clickhouse:
    # Xatu cluster (source data)
    xatu:
      mode: local  # "local" or "external"

# Example: Hybrid mode (local stack with external Xatu data)
# This mode runs CBT cluster, Redis, and Zookeeper locally,
# but connects to an external/production Xatu ClickHouse instance.
#
# Use cases:
#   - Testing with production data locally
#   - Developing CBT transformations against real data
#   - Debugging issues with production datasets
#
# infrastructure:
#   clickhouse:
#     xatu:
#       mode: external
#       # URL formats:
#       #   HTTP:  http://username:password@host:8123
#       #   HTTPS: https://username:password@host:8443
#       #   Native: clickhouse://username:password@host:9000
#       external_url: "https://readonly:supersecret@prod-xatu.example.com:8443"
#       external_database: "default"
#       external_username: "readonly"
#       external_password: "supersecret"
#     cbt:
#       mode: local  # CBT cluster always runs locally

    # CBT cluster (transformations)
    cbt:
      mode: local  # Always local for transformations

  redis:
    port: 6380

  volumes:
    persist: true  # Use named volumes (data survives down/up cycles)
                  # Set to false for clean slate every restart

# Port configuration
ports:
  lab_backend: 8080
  lab_frontend: 5173
  cbt_base: 8081      # Base port for CBT engines (+ network offset)
  cbt_api_base: 8091  # Base port for cbt-api services (+ network offset)

# Development features
dev:
  lab_rebuild_on_change: false  # Auto-rebuild lab frontend on changes
  hot_reload: true              # Enable hot reload for services that support it
